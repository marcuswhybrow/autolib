{% extends 'libraries/base.html' %}

{% block breadcrumbs %}
{{ block.super }}
<li> > <a href="{% url add_books %}">Add Books</a></li>
{% endblock %}

{% block head %}
<link rel="stylesheet" href="/media/js/jqtransform/jqtransform.css" />
<script type="text/javascript" src="/media/js/jqtransform/jquery.jqtransform.js"></script>
<script type="text/javascript" src="/media/js/jquery-ui-1.8rc1.custom.min.js"></script>
<script type="text/javascript" src="/media/js/jquery.blockUI.js"></script>
<script type="text/javascript">
	$(function() {
		$("form#add-books").jqTransform();
		
		$("form#add-books").submit(function() {
			
			var form = $(this);
			
			formData = form.serialize();
			
			$.post('{% url api_save_profile %}', formData, function(data){
				if (data.meta.success) {
					$.blockUI({ css: { 
			            border: 'none', 
			            padding: '15px', 
			            backgroundColor: '#000', 
			            '-webkit-border-radius': '10px', 
			            '-moz-border-radius': '10px', 
			            opacity: .5, 
			            color: '#fff' 
			        }, message: '<h1>' + data.book.title + '</h1><p>' + 
			        			data.book.author + '</p><p>' + 
			        			data.book.description + '</p><p>' + 
			        			data.book.publisher + '</p><p>' + 
			        			data.book.published + '</p><input type="button" id="go-to-profile" value="Go to Profile" />'
			        });
			        
			        $("#go-to-profile").click(function() {
			        	window.location.replace(data.profile.url);
			        });
				} else {
					$.blockUI({ 
						css: { 
				            border: 'none', 
				            padding: '15px', 
				            backgroundColor: '#000', 
				            '-webkit-border-radius': '10px', 
				            '-moz-border-radius': '10px', 
				            opacity: .5, 
				            color: '#fff' 
				        }, message: data.meta.error,
				        timeout: 2000
			        });
				}
			}, 'json');
			return false;
		});
	});
</script>
{% endblock %}

{% block content %}
	<div class="section">
		<div class="inner">
			<h1>Add Some Books</h1>
			<div class="clearfix">
				<div class="third alpha">
					<form id="add-books" action="" method="post" class="jqTransform">
					{% if collection %}<input type="hidden" name="collection_pk" value="{{ collection.pk }}" />{% endif %}
					<div class="rowElem clearfix">
						<input type="text" id="isbn" name="isbn" value="" />
					</div>
					<div class="button rowElem clearifx">
						<input type="submit" value="Find" />
					</div>
				</form>
				</div>
				<div class="third">
					<table id="lookup-status">
						<tr>
							<td class="source">Local</td>
							<td class="status">Checking</td>
						</tr>
						<tr>
							<td class="source">Google</td>
							<td class="status">Checking</td>
						</tr>
						<tr>
							<td class="source">Guardian</td>
							<td class="status">Checking</td>
						</tr>
					</table>
				</div>
				<div class="third omega">
					<h3>Book Title</h3>
					<p>Author</p>
					<p>Published</p>
				</div>
			</div>
		</div>
	</div>
{% endblock %}